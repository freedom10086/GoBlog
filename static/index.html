<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>发表新帖</title>
    <link rel="stylesheet" href="styles/my.css">
    <link rel="stylesheet" href="styles/editor.css">
    <link rel="stylesheet" href="styles/font-md.css">
    <script src="js/marked.js"></script>
    <script src="js/highlight.js"></script>
    <script src="js/editor.js"></script>

</head>
<body>
<h1>Markdown 在线编辑器 --by:yang</h1>
<div id="editor" class="editor">
</div>

<script>
    const testText = `
[TOC]
#### Disabled options

- TeX (Based on KaTeX);
- Emoji;
- Task lists;
- HTML tags decode;
- Flowchart and Sequence Diagram;

#### Editor.md directory

    editor.md/
            lib/
            css/
            scss/
            tests/
            fonts/
            images/
            plugins/
            examples/
            languages/
            editormd.js
            ...`;
    //窗口载入完成
    window.onload = function () {
        let editor = document.querySelector("#editor");
        initEditor(editor);
        let preview = document.querySelector("#markdown-preview");
        let input = document.querySelector("#editor-input");
        let textarea = document.querySelector("textarea");
        textarea.innerHTML = testText;

        marked.setOptions({
            highlight: function (code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        console.log(lang);
                        return hljs.highlight(lang, code).value;
                    } catch (err) {
                        console.log(err);
                    }
                }
                try {
                    return hljs.highlightAuto(code).value;
                } catch (err) {
                    console.log(err);
                }

                return code;
            }
        });


        mark(input.value, preview);

        input.oninput = function () {
            mark(input.value, preview);
        };

        textarea.addEventListener('scroll', function () {
            syncScroll(textarea, preview);
        });
    };

    function mark(text, preview) {
        marked(text, function (err, content) {
            if (err) throw err;
            preview.innerHTML = content;
        });
    }
</script>
</body>
</html>